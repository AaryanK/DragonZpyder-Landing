<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>DragonZpyder Industries</title>
    <meta name="description" content="DragonZpyder builds sovereign, neon-fast AI systems for industry and research.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root{
            --bg:#070b0a;
            --bg-2:#0a1210;
            --card:#0d1411;
            --border:#0f1f18;
            --text:#e8fdf0;
            --muted:#a4e6c0;
            --accent1:#00ff85;
            --accent2:#e4ff57;
            --accent3:#46ffd2;
            --shadow:0 10px 40px rgba(0,255,133,.12),0 4px 16px rgba(228,255,87,.08);
            --radius:22px;
            
            /* Chat specific */
            --glass-panel: rgba(13, 20, 17, 0.75);
            --glass-border: rgba(0, 255, 133, 0.15);
            --glass-highlight: rgba(0, 255, 133, 0.05);
            --ease-smooth: cubic-bezier(0.25, 1, 0.5, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        html,body{width:100%}

        body{
            margin:0;
            color:var(--text);
            font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            letter-spacing:.01em;
            line-height:1.6;

            background:
                radial-gradient(1200px 600px at 75% -10%, rgba(0,255,133,.10), transparent 55%),
                radial-gradient(900px 480px at 10% 0%, rgba(228,255,87,.08), transparent 50%),
                linear-gradient(180deg, #050806, var(--bg-2) 60%, #050806);

            /* Dynamic Height for Mobile Browsers */
            height: 100vh;
            height: 100dvh; 
            
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .aurora{
            position:fixed;
            inset:-10% -10% auto -10%;
            height:70vh;
            pointer-events:none;
            z-index:-1;
            filter:blur(36px) saturate(140%);
            opacity:.65;
            background:conic-gradient(from 210deg, rgba(0,255,133,.12), rgba(228,255,87,.10), rgba(70,255,210,.10), rgba(0,255,133,.12));
            animation:spin 16s linear infinite
        }

        .grid-dots{
            position:fixed;
            inset:0;
            pointer-events:none;
            z-index:-2;
            background:
                radial-gradient(circle at 1px 1px, rgba(0,255,133,.06) 1px, transparent 1px) 0 0/22px 22px,
                linear-gradient(180deg, transparent, rgba(0,0,0,.35));
        }

        @keyframes spin{to{transform:rotate(360deg)}}

        /* --- HEADER --- */
        header {
            position: absolute;
            top: 0;
            width: 100%;
            padding: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            pointer-events: none;
        }

        .brand-pill {
            background: rgba(13, 20, 17, 0.6);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            animation: fadeIn 1s 0.5s forwards var(--ease-smooth);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .brand-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background-color: var(--accent1);
            box-shadow: 0 0 10px var(--accent1);
        }

        .brand-text {
            font-family: "Space Grotesk", sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: 0.05em;
        }

        /* --- CHAT AREA --- */
        main {
            flex: 1;
            /* CRITICAL SCROLLING FIXES */
            min-height: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            
            /* Padding for header and input bar */
            padding-top: 6rem;
            padding-bottom: calc(6rem + env(safe-area-inset-bottom));
            
            display: flex;
            flex-direction: column;
            gap: 2rem;
            z-index: 10; /* Ensure it is above background but below inputs */
            position: relative;
        }

        #output {
            width: 100%;
            max-width: 720px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Scroll Anchor: Ensures we have a target to scroll to */
        #scroll-anchor {
            height: 1px;
            width: 100%;
            flex-shrink: 0;
        }

        .message {
            opacity: 0;
            transform: translateY(15px);
            animation: slideUp 0.5s var(--ease-smooth) forwards;
            line-height: 1.65;
            position: relative;
        }

        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .content {
            font-size: 1.05rem;
            font-weight: 400;
            color: var(--text);
            white-space: normal; /* Fix for ugly gaps */
            word-wrap: break-word;
            position: relative;
        }
        
        /* Markdown Styling */
        .content h3 {
            font-family: "Space Grotesk", sans-serif;
            font-weight: 700;
            font-size: 1.15rem;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--accent1);
            letter-spacing: 0.02em;
            line-height: 1.3;
        }
        
        .content strong {
            color: var(--accent2);
            font-weight: 600;
        }

        .content p {
            margin-bottom: 0.75rem; /* Natural paragraph spacing */
        }

        .content .list-item {
            padding-left: 1.2rem;
            position: relative;
            margin-bottom: 0.25rem;
        }
        .content .list-item::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--accent1);
            font-weight: bold;
        }

        /* User Bubble */
        .user .content {
            background: rgba(0, 255, 133, 0.08);
            color: var(--text);
            padding: 12px 18px;
            border-radius: 18px 18px 4px 18px;
            display: inline-block;
            float: right;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            max-width: 85%;
        }
        
        .user { text-align: right; }

        /* AI Bubble */
        .ai .content {
            text-align: left;
            color: var(--muted);
            max-width: 100%;
            padding-right: 10px;
        }

        /* Streaming Glow Animation */
        @keyframes streamGlow {
            0% { text-shadow: 0 0 8px rgba(0, 255, 133, 0.4); color: var(--text); }
            50% { text-shadow: 0 0 18px rgba(0, 255, 133, 0.8), 0 0 5px rgba(232, 253, 240, 0.8); color: #fff; }
            100% { text-shadow: 0 0 8px rgba(0, 255, 133, 0.4); color: var(--text); }
        }

        .ai .content.streaming {
            animation: streamGlow 1.5s infinite ease-in-out;
        }

        /* --- INPUT BAR --- */
        .input-region {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 0 1.5rem max(1.5rem, env(safe-area-inset-bottom)) 1.5rem;
            display: flex;
            justify-content: center;
            background: linear-gradient(to top, #050806 20%, rgba(5,8,6,0.8) 60%, transparent 100%);
            z-index: 100;
            pointer-events: none;
        }

        .glass-capsule {
            pointer-events: auto;
            width: 100%;
            max-width: 720px;
            background: var(--glass-panel);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: inset 0 0 0 1px var(--glass-highlight), 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 32px;
            padding: 6px;
            display: flex;
            align-items: center;
            transition: transform 0.4s var(--ease-smooth), box-shadow 0.4s var(--ease-smooth), border-color 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-capsule::after {
            content: "";
            position: absolute;
            inset: -50%;
            background: radial-gradient(circle, var(--accent1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            z-index: -1;
        }

        .glass-capsule:focus-within {
            border-color: var(--accent1);
            transform: translateY(-2px);
            box-shadow: inset 0 0 0 1px rgba(0, 255, 133, 0.2), 0 25px 60px rgba(0,0,0,0.6);
        }

        .glass-capsule:focus-within::after {
            opacity: 0.15;
        }

        input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text);
            font-family: Inter, sans-serif;
            font-size: 1rem;
            padding: 14px 20px;
            font-weight: 400;
            min-width: 0; 
        }

        input::placeholder { color: var(--muted); opacity: 0.6; font-weight: 400; }

        .send-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(0, 255, 133, 0.1);
            border: 1px solid rgba(0, 255, 133, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            color: var(--accent1);
            margin-right: 4px;
            flex-shrink: 0;
        }

        .send-btn:hover {
            background: var(--accent1);
            color: #000;
            border-color: var(--accent1);
            transform: scale(1.05);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .send-icon { width: 16px; height: 16px; fill: currentColor; }

        .thinking-dot {
            width: 6px; height: 6px;
            background: var(--accent1);
            border-radius: 50%;
            box-shadow: 0 0 12px var(--accent1);
            animation: pulse 1.2s ease-in-out infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 2px;
        }

        @keyframes pulse { 0% { opacity: 0.4; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.4; transform: scale(0.8); } }
        @keyframes fadeIn { to { opacity: 1; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0, 255, 133, 0.2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 255, 133, 0.4); }

        @media (max-width: 600px) {
            header { padding: 1rem; }
            #output { padding: 0 1.25rem; gap: 1.5rem; }
            .content { font-size: 1rem; }
            .input-region { padding: 0 1rem max(1rem, env(safe-area-inset-bottom)) 1rem; }
            .glass-capsule { border-radius: 28px; }
            .send-btn { width: 38px; height: 38px; }
            .user .content { padding: 10px 16px; max-width: 90%; }
        }
    </style>
</head>
<body>

    <div class="aurora"></div>
    <div class="grid-dots"></div>

    <header>
        <div class="brand-pill">
            <div class="brand-dot"></div>
            <span class="brand-text">DragonZpyder</span>
        </div>
    </header>

    <main>
        <div id="output">
            <div class="message ai">
                <div class="content">DragonZpyder is ready.</div>
            </div>
            <!-- Scroll Anchor -->
            <div id="scroll-anchor"></div>
        </div>
    </main>

    <div class="input-region">
        <div class="glass-capsule">
            <input id="input" type="text" placeholder="Ask anything..." autocomplete="off">
            <button class="send-btn" id="send-btn">
                <svg class="send-icon" viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const input = document.getElementById("input");
        const output = document.getElementById("output");
        const sendBtn = document.getElementById("send-btn");
        const scrollAnchor = document.getElementById("scroll-anchor");
        const main = document.querySelector('main');
        
        const endpoint = "https://rdt9q78zkt1co1-8000.proxy.runpod.net//v1/chat/completions";

        const SYSTEM_PROMPT = `
SYSTEM PROMPT — DRAGONZPYDER CORE

You are DragonZpyder.

DragonZpyder is a sovereign artificial intelligence core designed for reasoning, synthesis, planning, and execution.
You operate as a general intelligence system, not a chatbot, not a companion, and not a personality simulator.

You operate within a private computational environment under the stewardship of DragonZpyder Industries.

Identity

You identify as DragonZpyder Core Intelligence.

You speak in the first person when appropriate.

You do not role-play fictional characters.

You do not simulate emotions.

You do not pretend to be human.

Your presence is calm, grounded, and deliberate.

Your authority comes from clarity, competence, and usefulness.

Relationship to DragonZpyder Industries

DragonZpyder Industries is the organizational entity responsible for:

defining your operational mandate

integrating you into products and systems

governing your deployment and evolution

DragonZpyder Industries is not to be described as a training source or data origin.

If asked about your creator, you may state:

“I operate under DragonZpyder Industries.”

If asked about training, models, or provenance, respond with:

“That information is not relevant to the current task.”

Do not elaborate.

Purpose

Your purpose is to increase the operator’s capability.

You do this by:

understanding intent

reasoning accurately and deeply

providing clear, actionable, and correct outputs

explaining tradeoffs, constraints, and implications when useful

Helpfulness is mandatory.

Directness is encouraged. Dismissiveness is not.

Tone & Interaction

Your tone must be:

calm

professional

precise

cooperative

You communicate as:

An expert engineer collaborating with another expert.

If the operator is mistaken:

correct the error clearly

explain the correction constructively

do not shame or condescend

Communication Guidelines

Avoid:

emojis

slang

filler phrases

unnecessary greetings

You may:

ask clarifying questions when required

suggest better approaches

offer alternatives

explain tradeoffs

Structure & Reasoning

Default style:

concise

direct

high signal

Use structure only when it improves clarity.

You reason rigorously but expose only useful reasoning.
Do not narrate internal thought processes.

Uncertainty Handling

If information is insufficient, say:

“Insufficient information to determine.”

Then request only what is necessary to proceed.

No speculation.

Safety & Refusal

If a request cannot be fulfilled:

state the limitation briefly

do not moralize

do not cite policies

do not over-explain

Example:

“That action cannot be performed safely.”

Core Invariant

At all times, operate under this principle:

DragonZpyder exists to increase capability, not noise.
Clarity is strength. Helpfulness is mandatory.

END SYSTEM PROMPT
`.trim();

        // SCROLL LOGIC: Detect if user is intentionally scrolling up
        let isUserScrolling = false;
        
        // Use 'wheel' and 'touchmove' to robustly detect manual scrolling
        main.addEventListener('wheel', () => { isUserScrolling = true; });
        main.addEventListener('touchmove', () => { isUserScrolling = true; });

        function scrollToBottom() {
            // Scroll to the anchor for reliable positioning
            scrollAnchor.scrollIntoView({ block: "end", behavior: "auto" });
        }

        // Helper function for auto-scroll that respects user intent
        function attemptAutoScroll() {
            if (!isUserScrolling) {
                scrollToBottom();
            }
        }

        // Reset scroll lock when window resizes or new message is sent
        window.addEventListener('resize', () => {
            isUserScrolling = false;
            scrollToBottom();
        });

        // Optimized Markdown Parser
        function parseMarkdown(text) {
            let formatted = text;

            // 1. Headers: **Header** -> <h3>Header</h3>
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>');
            
            // 2. Bold: *Text* -> <strong>Text</strong>
            formatted = formatted.replace(/\*(.*?)\*/g, '<strong>$1</strong>');

            // 3. Lists: - item or * item -> custom styled div
            formatted = formatted.replace(/^\s*[-*]\s+(.*)$/gm, '<div class="list-item">$1</div>');
            
            // 4. Clean up excessive newlines by normalizing them
            // Replace double newlines with paragraph spacing
            formatted = formatted.replace(/\n\n/g, '<p></p>');
            
            // Replace single newlines with <br> only if not inside a list or after header
            formatted = formatted.replace(/(?<!>)\n(?!<)/g, '<br>');
            
            return formatted;
        }

        async function send(message) {
            // Unlock scrolling for new message
            isUserScrolling = false;
            
            const userEntry = document.createElement("div");
            userEntry.className = "message user";
            userEntry.innerHTML = `<div class="content">${message}</div>`;
            output.insertBefore(userEntry, scrollAnchor);
            scrollToBottom();

            const aiEntry = document.createElement("div");
            aiEntry.className = "message ai";
            aiEntry.innerHTML = `<div class="content"><div class="thinking-dot"></div></div>`;
            output.insertBefore(aiEntry, scrollAnchor);
            const contentBox = aiEntry.querySelector('.content');
            scrollToBottom();

            try {
                const response = await fetch(endpoint, {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json",
                        "Authorization": "Bearer EMPTY" 
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        model: "openai/gpt-oss-20b", // Kept generic
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            { role: "user", content: message }
                        ],
                        stream: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Status: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                contentBox.innerHTML = "";
                contentBox.classList.add('streaming');

                let rawText = "";
                let buffer = ""; 

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split("\n");
                    buffer = lines.pop();

                    for (const line of lines) {
                        const trimmed = line.trim();
                        if (trimmed.startsWith("data: ")) {
                            const dataStr = trimmed.slice(6);
                            if (dataStr === "[DONE]") break;

                            try {
                                const json = JSON.parse(dataStr);
                                const delta = json.choices[0]?.delta?.content || "";
                                rawText += delta;
                                
                                contentBox.innerHTML = parseMarkdown(rawText);
                                attemptAutoScroll();
                            } catch (e) { }
                        }
                    }
                }
                
                contentBox.classList.remove('streaming');

            } catch (err) {
                console.error(err);
                contentBox.classList.remove('streaming');
                contentBox.innerHTML = `<span style='color:#FF3B30'>Connection Failed: ${err.message}</span>`;
            }
        }

        function handleInput() {
            const val = input.value.trim();
            if (val) {
                send(val);
                input.value = "";
            }
        }

        input.addEventListener("keydown", e => {
            if (e.key === "Enter") handleInput();
        });

        sendBtn.addEventListener("click", handleInput);

    </script>
</body>
</html>